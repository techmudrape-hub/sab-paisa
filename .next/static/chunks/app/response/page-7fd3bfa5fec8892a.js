(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[196],{56:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var r=a(5155),s=a(2115),n=a(4645),o=a(9618);a(1463);var d=a(1463);let l=()=>{let e=(0,n.useRouter)(),[t,a]=(0,s.useState)([]),[l,i]=(0,s.useState)(null),[c,u]=(0,s.useState)(""),[p,y]=(0,s.useState)(null),[f,m]=(0,s.useState)("pending"),[g,h]=(0,s.useState)("");return d.env.SHARED_SECRET,(0,s.useEffect)(()=>{(async()=>{try{let e=await (0,o.z)("doJx8Ihyb2s/sh1pbYEDfa6JdsogEYMXKEoPF/BEwrg=","iw/0vT01OWRph/rQplst/W7k423JXrgo4xBn3gXPsIDXTTXE461f4V4QYKGQ8wTe");if(console.log("\uD83D\uDD11 Decrypted response:",e),y(e||{}),a(e&&"object"==typeof e?Object.entries(e):[]),e&&"object"==typeof e){let t,a,r,s,n,o=(t=(e.status||e.STATUS||e.paymentStatus||"").toString().toUpperCase(),a=(e.statusCode||e.STATUS_CODE||e.gatewayResponseCode||"").toString(),r=(e.sabpaisaMessage||e.responseMessage||e.RESPONSE_MESSAGE||e.message||e.bankMessage||"").toString(),s=["SUCCESS","SUCCESSFUL","COMPLETED"].includes(t)||["0000","00"].includes(a),n=["FAILED","FAILURE","CANCELLED","CANCELED","ERROR","REJECTED"].includes(t),s?{status:"success",message:r||"Payment completed successfully!"}:n?{status:"cancelled",message:r||"Payment failed or cancelled."}:{status:"pending",message:"Payment is being processed..."});m(o.status),h(o.message);let d={txnId:e.clientTxnId||e.CLIENT_TXN_ID||e.txnId||"",sabpaisaTxnId:e.sabpaisaTxnId||e.SABPAISA_TXN_ID||e.txnId||"",referenceId:e.clientTxnId||e.CLIENT_TXN_ID||e.txnId||"",amount:Number(e.amount)||0,status:"success"===o.status?"SUCCESS":"cancelled"===o.status?"FAILED":"PENDING",responseMessage:e.sabpaisaMessage||e.responseMessage||e.message||e.bankMessage||o.message,userId:e.payerEmail||e.userId||"",type:e.type||"PAYMENT",description:e.description||"Payment",payerName:e.payerName||e.PAYER_NAME||"Unknown User",payerEmail:e.payerEmail||e.PAYER_EMAIL||e.userId||"",statusCode:e.statusCode||e.STATUS_CODE||e.gatewayResponseCode||("success"===o.status?"0000":"9999"),metadata:{...e},createdAt:new Date().toISOString()};if(d.amount>0)try{let t=await fetch("/api/transactions",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({amount:d.amount,transactionId:d.referenceId,sabpaisaTxnId:d.sabpaisaTxnId,paymentData:{statusCode:d.statusCode,mappedStatus:(o.status||"").toLowerCase(),...e}})}),a=await t.json();t.ok?a.success?console.log("✅ Transaction saved successfully and wallet credited:",a):console.log("⚠️ Transaction saved but payment not successful:",a):console.error("❌ Failed to save transaction:",a)}catch(e){console.error("❌ Failed to save transaction:",e)}}}catch(e){console.error("Error parsing payment response:",e),m("cancelled"),h("Error processing payment response")}})()},[]),(0,r.jsxs)("div",{style:{padding:"2rem",fontFamily:"Arial"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[(0,r.jsx)("h2",{style:{margin:0},children:"Payment Response Details"}),(0,r.jsx)("button",{onClick:()=>e.push("/pay-in"),style:{padding:"10px 20px",backgroundColor:"#0070f3",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"background-color 0.3s"},onMouseOver:e=>e.target.style.backgroundColor="#0051cc",onMouseOut:e=>e.target.style.backgroundColor="#0070f3",children:"← Back to Add Money"})]}),l&&(0,r.jsx)("div",{style:{marginBottom:"1rem",padding:"10px",borderRadius:"5px",backgroundColor:"success"===l?"#d4edda":"#f8d7da",border:`1px solid ${"success"===l?"#c3e6cb":"#f5c6cb"}`,color:"success"===l?"#155724":"#721c24"},children:(0,r.jsx)("strong",{children:c})}),(0,r.jsxs)("table",{border:"1",cellPadding:"10",cellSpacing:"0",style:{width:"100%",borderCollapse:"collapse"},children:[(0,r.jsx)("thead",{style:{backgroundColor:"#f2f2f2"},children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{style:{textAlign:"left"},children:"Field"}),(0,r.jsx)("th",{style:{textAlign:"left"},children:"Value"})]})}),(0,r.jsx)("tbody",{children:t.map(([e,t])=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e}),(0,r.jsx)("td",{children:null===t?(0,r.jsx)("i",{style:{color:"gray"},children:"N/A"}):String(t)})]},e))})]})]})}},4386:(e,t,a)=>{Promise.resolve().then(a.bind(a,56))},9618:(e,t,a)=>{"use strict";let r;a.d(t,{j:()=>c,z:()=>u});let s=[];for(let e=0;e<256;++e)s.push((e+256).toString(16).slice(1));let n=new Uint8Array(16);var o={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let d={async encrypt(e,t,a){let r=l(e),s=l(t),n=crypto.getRandomValues(new Uint8Array(12)),o=await crypto.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt"]),d=await crypto.subtle.encrypt({name:"AES-GCM",iv:n,tagLength:128},o,(new TextEncoder).encode(a)),i=new Uint8Array(n.length+d.byteLength);i.set(n),i.set(new Uint8Array(d),n.length);let c=await crypto.subtle.importKey("raw",s,{name:"HMAC",hash:"SHA-384"},!1,["sign"]),u=await crypto.subtle.sign("HMAC",c,i),p=new Uint8Array(u.byteLength+i.length);return p.set(new Uint8Array(u)),p.set(i,u.byteLength),Array.from(p).map(e=>e.toString(16).padStart(2,"0").toUpperCase()).join("")},async decrypt(e,t,a){let r=l(e),s=l(t),n=function(e){let t=new Uint8Array(e.length/2);for(let a=0;a<e.length;a+=2)t[a/2]=parseInt(e.substring(a,a+2),16);return t}(a);if(n.length<76)throw Error("Invalid ciphertext length");let o=n.slice(0,48),d=n.slice(48),i=await crypto.subtle.importKey("raw",s,{name:"HMAC",hash:"SHA-384"},!1,["verify"]);if(!await crypto.subtle.verify("HMAC",i,o,d))throw Error("HMAC validation failed. Data may be tampered!");let c=d.slice(0,12),u=d.slice(12),p=await crypto.subtle.importKey("raw",r,"AES-GCM",!1,["decrypt"]),y=await crypto.subtle.decrypt({name:"AES-GCM",iv:c,tagLength:128},p,u);return(new TextDecoder).decode(y)}};function l(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}let i="https://stage-securepay.sabpaisa.in/SabPaisa/sabPaisaInit?v=1",c=async({clientCode:e,transUserName:t,transUserPassword:a,callbackUrl:l,authKey:c,authIV:u,payerName:p,payerEmail:y,payerMobile:f,amount:m,udf1:g,udf2:h,udf3:b,udf4:E,udf5:S,udf6:w,udf7:C,udf8:I,udf9:x,udf10:A,udf11:U,udf12:T,udf13:v,udf14:P,udf15:D,udf16:M,udf17:j,udf18:N,udf19:R,udf20:L,payerVpa:k,modeTransfer:_,byPassFlag:O,cardHolderName:F,pan:H,cardExpMonth:V,cardExpYear:X,cardType:Y,cvv:G,browserDetails:K,bankId:B,channelId:J,clientTxnId:z,env:Q})=>{let W=new URLSearchParams({payerName:p,payerEmail:y,payerMobile:f,clientTxnId:z||(function(e,t,a){if(o.randomUUID&&!e)return o.randomUUID();let d=(e=e||{}).random??e.rng?.()??function(){if(!r){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");r=crypto.getRandomValues.bind(crypto)}return r(n)}();if(d.length<16)throw Error("Random bytes length must be >= 16");return d[6]=15&d[6]|64,d[8]=63&d[8]|128,function(e,t=0){return(s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]).toLowerCase()}(d)})().replace(/-/g,"").slice(0,20).toUpperCase(),amount:m,clientCode:e,transUserName:t,transUserPassword:a,callbackUrl:l,channelId:J,udf1:g,udf2:h,udf3:b,udf4:E,udf5:S,udf6:w,udf7:C,udf8:I,udf9:x,udf10:A,udf11:U,udf12:T,udf13:v,udf14:P,udf15:D,udf16:M,udf17:j,udf18:N,udf19:R,udf20:L,payerVpa:k,modeTransfer:_,byPassFlag:O,cardHolderName:F,pan:H,cardExpMonth:V,cardExpYear:X,cardType:Y,cvv:G,browserDetails:K,bankId:B}),$=await d.encrypt(c,u,W.toString());if(!$)throw Error("Encryption failed");{let t=document.createElement("form");t.method="POST",t.action=({uat:"https://secure.sabpaisa.in/SabPaisa/sabPaisaInit?v=1",stag:i,prod:"https://securepay.sabpaisa.in/SabPaisa/sabPaisaInit?v=1"})[Q.toLowerCase()]||i;let a=(e,t)=>{let a=document.createElement("input");return a.type="hidden",a.name=e,a.value=t,a};t.appendChild(a("encData",$)),t.appendChild(a("clientCode",e)),document.body.appendChild(t),t.submit()}},u=async(e,t)=>{let a=new URLSearchParams(window.location.search).get("encResponse");if(e&&t&&a){let r=(e=>{let t=Object.fromEntries(new URLSearchParams(e));for(let e in t)"null"===t[e]&&(t[e]=null);return t})(await d.decrypt(e,t,a.replaceAll(" ","+")));if(r)return r;throw Error("Invalid response data")}}}},e=>{e.O(0,[441,794,358],()=>e(e.s=4386)),_N_E=e.O()}]);