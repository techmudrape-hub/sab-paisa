(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[196],{1464:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});var a=t(5155),o=t(9137),n=t.n(o),r=t(2115);let l=e=>{let{status:s,message:t,onStatusChange:o}=e,[l,c]=(0,r.useState)(s||"pending"),[i,d]=(0,r.useState)(t||"");(0,r.useEffect)(()=>{s&&c(s)},[s]),(0,r.useEffect)(()=>{t&&d(t)},[t]);let p=(e=>{switch(e.toLowerCase()){case"success":case"completed":case"paid":return{color:"#4caf50",backgroundColor:"#e8f5e8",borderColor:"#4caf50",icon:"✅",text:"Payment Successful",message:i||"Your payment has been processed successfully!"};case"cancelled":case"canceled":case"failed":case"error":return{color:"#f44336",backgroundColor:"#ffebee",borderColor:"#f44336",icon:"❌",text:"Payment Failed",message:i||"Payment was cancelled or failed. Please try again."};case"pending":case"processing":case"in_progress":return{color:"#ff9800",backgroundColor:"#fff3e0",borderColor:"#ff9800",icon:"⏳",text:"Payment Pending",message:i||"Your payment is being processed. Please wait..."};default:return{color:"#9e9e9e",backgroundColor:"#f5f5f5",borderColor:"#9e9e9e",icon:"❓",text:"Unknown Status",message:i||"Payment status is unknown."}}})(l);return(0,a.jsxs)("div",{style:{padding:"20px",margin:"20px 0",borderRadius:"8px",border:"2px solid ".concat(p.borderColor),backgroundColor:p.backgroundColor,textAlign:"center",fontFamily:"Arial, sans-serif"},className:"jsx-d732791046adfab6",children:[(0,a.jsx)("div",{style:{fontSize:"48px",marginBottom:"10px"},className:"jsx-d732791046adfab6",children:p.icon}),(0,a.jsx)("h2",{style:{color:p.color,margin:"0 0 10px 0",fontSize:"24px",fontWeight:"bold"},className:"jsx-d732791046adfab6",children:p.text}),(0,a.jsx)("p",{style:{color:p.color,margin:"0 0 15px 0",fontSize:"16px",lineHeight:"1.4"},className:"jsx-d732791046adfab6",children:p.message}),"pending"===l&&(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:"15px"},className:"jsx-d732791046adfab6",children:[(0,a.jsx)("div",{style:{width:"20px",height:"20px",border:"2px solid ".concat(p.color),borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite",marginRight:"10px"},className:"jsx-d732791046adfab6"}),(0,a.jsx)("span",{style:{color:p.color,fontSize:"14px"},className:"jsx-d732791046adfab6",children:"Processing..."})]}),(0,a.jsx)(n(),{id:"d732791046adfab6",children:"@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}"})]})}},4386:(e,s,t)=>{Promise.resolve().then(t.bind(t,8696))},8696:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>d});var a=t(5155),o=t(2115),n=t(740),r=t(9509);let l=async e=>{try{let s,t="/api/transactions",a=r.env.SHARED_SECRET||"mytransactionsecratekeyinder81",o={txnId:e.txnId||"TXN-".concat(Date.now()),payerName:e.payerName||"Unknown User",payerEmail:e.payerEmail||"unknown@example.com",amount:e.amount||0,description:e.description||"Payment",type:e.type||"PAYMENT",referenceId:e.referenceId||"REF-${Date.now()}",currency:e.currency||"INR",status:e.status||"UNKNOWN",responseMessage:e.responseMessage||"",userId:e.userId||"",metadata:e.metadata||{},statusCode:e.statusCode||"PENDING",createdAt:e.createdAt||new Date().toISOString()};console.log("Sending to Site B:",t,o);let n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("my-client-token"),"x-shared-secret":a},body:JSON.stringify(o)}),l=await n.text();if(console.log("Raw Response:",l),!n.ok)throw Error("Site B Error (Status ".concat(n.status,"): ").concat(l));try{s=JSON.parse(l)}catch(e){s={raw:l}}return console.log("Parsed Response:",s),s}catch(e){throw console.error("Failed to send transaction:",e.message),e}};var c=t(1464),i=t(9509);let d=()=>{let[e,s]=(0,o.useState)([]),[t,r]=(0,o.useState)(null),[d,p]=(0,o.useState)(""),[g,m]=(0,o.useState)(null),[u,y]=(0,o.useState)("pending"),[h,E]=(0,o.useState)(""),[f,x]=(0,o.useState)(!0),S=i.env.SHARED_SECRET||"mytransactionsecratekeyinder81",b=async e=>{try{let s={txnId:e.txnId||e.clientTxnId||e.CLIENT_TXN_ID||"",sabpaisaTxnId:e.sabpaisaTxnId||e.SABPAISA_TXN_ID||e.txnId||"",referenceId:e.referenceId||e.txnId||e.clientTxnId||e.CLIENT_TXN_ID||"",amount:Number(e.amount)||0,status:e.status||"UNKNOWN",responseMessage:e.responseMessage||e.sabpaisaMessage||e.message||e.bankMessage||"",userId:e.userId||"",type:e.type||"PAYMENT",description:e.description||"Payment",payerName:e.payerName||"Unknown User",payerEmail:e.payerEmail||"",statusCode:e.statusCode||"PENDING",metadata:e.metadata||{},createdAt:e.createdAt||new Date().toISOString()};console.log("============== SENDING TO SITE B =============="),console.log("Payload ::",s),console.log("Status being sent:",s.status),console.log("Response message being sent:",s.responseMessage),console.log("Headers ::",{Authorization:"Bearer ".concat("my-client-token"),"x-shared-secret":S}),console.log("===============================================");let t=await l(s);console.log("Site B Response (raw)::",t),r("success"),p("Transaction saved on Site B")}catch(e){console.error("Error saving transaction on Site B ::",e),e.response&&console.error("Site B Error Response:",e.response.data),r("error"),p("Error saving transaction on Site B")}};return(0,o.useEffect)(()=>{{let e=new URLSearchParams(window.location.search),s=e.get("success"),t=e.get("error"),a=e.get("message");"true"===s&&a?console.log("[RESPONSE] Payment success flag detected:",a):(t||a)&&console.log("[RESPONSE] Payment error detected:",t||a)}let e="doJx8Ihyb2s/sh1pbYEDfa6JdsogEYMXKEoPF/BEwrg=",t="iw/0vT01OWRph/rQplst/W7k423JXrgo4xBn3gXPsIDXTTXE461f4V4QYKGQ8wTe";try{if(e&&t){let s=atob(e).length,a=atob(t).length;console.log("========== CRYPTO DEBUG =========="),console.log("algo:",32===s?"aes-256-cbc":16===s?"aes-128-cbc":"unknown"),console.log("key bytes:",s,"iv bytes:",a),console.log("key (base64):",e),console.log("iv (base64):",t),console.log("==================================")}else console.log("Missing env vars: NEXT_PUBLIC_AUTH_KEY or NEXT_PUBLIC_AUTH_IV")}catch(e){console.log("crypto debug error",(null==e?void 0:e.message)||e)}(async()=>{try{{console.log("[RESPONSE DEBUG] Current URL:",window.location.href),console.log("[RESPONSE DEBUG] URL Search Params:",window.location.search);let e=new URLSearchParams(window.location.search),t=e.get("encResponse"),a=e.get("clientCode");if(console.log("[RESPONSE DEBUG] encResponse exists:",!!t,"Length:",(null==t?void 0:t.length)||0),console.log("[RESPONSE DEBUG] clientCode:",a),!t&&!a){if(console.warn("[RESPONSE DEBUG] No payment parameters found in URL query string."),window.location.hash){let e=new URLSearchParams(window.location.hash.substring(1)),s=e.get("encResponse"),t=e.get("clientCode");console.log("[RESPONSE DEBUG] Checking URL hash for parameters..."),console.log("[RESPONSE DEBUG] Hash encResponse:",!!s),console.log("[RESPONSE DEBUG] Hash clientCode:",t)}"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname?(y("pending"),E("Payment response not received yet. If payment was completed, please wait or contact support.")):(y("pending"),E("Waiting for payment response... Please complete payment or check payment status."));let e={fullUrl:window.location.href,pathname:window.location.pathname,search:window.location.search,hash:window.location.hash,hostname:window.location.hostname,protocol:window.location.protocol,note:"No payment parameters found in URL. Payment gateway may not have redirected properly with parameters."};s(Object.entries(e)),x(!1);return}}if(!e||!t)throw Error("Missing AUTH_KEY or AUTH_IV. Please check environment variables.");let l=await (0,n.z)(e,t);if(console.log("\uD83D\uDD11 Full decrypted response object:",l),!l){console.error("[RESPONSE ERROR] parsePaymentResponse returned null or undefined"),y("cancelled"),E("Failed to parse payment response. Payment data may be missing or invalid."),s([["error","No payment data found in URL parameters"]]);return}if(m(l||{}),s(l&&"object"==typeof l?Object.entries(l):[]),x(!1),l&&"object"==typeof l){var a,o,r;let e=(e=>{let s=(e.status||e.STATUS||e.paymentStatus||"").toString().toUpperCase(),t=(e.statusCode||e.STATUS_CODE||e.gatewayResponseCode||"").toString(),a=(e.sabpaisaMessage||e.responseMessage||e.RESPONSE_MESSAGE||e.message||e.bankMessage||"").toString();return(console.log("[RESPONSE] Raw status:",s,"StatusCode:",t,"RespMsg:",a),console.log("[RESPONSE] Full payment data keys:",Object.keys(e)),"SUCCESS"===s||"SUCCESSFUL"===s||"COMPLETED"===s)?{status:"success",message:a||"Payment completed successfully!"}:"FAILED"===s||"FAILURE"===s||"CANCELLED"===s||"CANCELED"===s||"ERROR"===s||"REJECTED"===s?{status:"cancelled",message:a||"Payment was cancelled or failed."}:"0000"===t||"00"===t?{status:"success",message:a||"Payment completed successfully!"}:t&&"0000"!==t&&"00"!==t?{status:"cancelled",message:a||"Payment failed with status code: "+t}:{status:"pending",message:"Payment is being processed..."}})(l);y(e.status),E(e.message),console.log("[RESPONSE] SabPaisa mapped status:",e.status,"message:",e.message),console.log("[RESPONSE] Original data status field:",l.status),console.log("[RESPONSE] Original data statusCode field:",l.statusCode),console.log("[RESPONSE] Original data sabpaisaMessage field:",l.sabpaisaMessage);let s=l.clientTxnId||l.CLIENT_TXN_ID||l.txnId||"",t=null;if(s)try{let e=await fetch("/api/transactions?txnId=".concat(encodeURIComponent(s)));if(e.ok){let s=await e.json();t=s.userId||(null==(r=s.metadata)?void 0:r.userId)||null,console.log("[RESPONSE] Fetched userId from database:",t)}}catch(e){console.warn("[RESPONSE] Could not fetch from database:",e)}let n=(null==(a=l.metadata)?void 0:a.userId)||(null==(o=l.metadata)?void 0:o.USER_ID)||("object"==typeof l.metadata&&l.metadata?l.metadata.userId:null),c=t||n||l.userId||l.payerEmail||"",i={txnId:s,sabpaisaTxnId:l.sabpaisaTxnId||l.SABPAISA_TXN_ID||l.txnId||"",referenceId:s,amount:Number(l.amount)||0,status:"success"===e.status?"SUCCESS":"cancelled"===e.status?"FAILED":"PENDING",responseMessage:l.sabpaisaMessage||l.responseMessage||l.message||l.bankMessage||e.message,userId:c,type:l.type||"PAYMENT",description:l.description||"Payment",payerName:l.payerName||l.PAYER_NAME||"Unknown User",payerEmail:l.payerEmail||l.PAYER_EMAIL||l.userId||"",statusCode:l.statusCode||l.STATUS_CODE||l.gatewayResponseCode||("success"===e.status?"0000":"9999"),metadata:{...l},createdAt:new Date().toISOString()};console.log("[RESPONSE] Final userId being sent to Site B: ".concat(c)),console.log("[RESPONSE] Payment status: ".concat(i.status,". Saving to Site B...")),await b(i)}}catch(e){console.error("Error parsing payment response:",e),console.error("Error details:",{message:e.message,stack:e.stack,name:e.name}),y("cancelled"),E("Error processing payment response: ".concat(e.message||"Unknown error")),s(Object.entries({error:e.message||"Unknown error",errorType:e.name||"Error",url:window.location.href,timestamp:new Date().toISOString(),suggestion:"Please check browser console for detailed error logs."})),x(!1)}})()},[]),(0,a.jsxs)("div",{style:{padding:"2rem",fontFamily:"Arial",maxWidth:"1200px",margin:"0 auto"},children:[(0,a.jsx)("div",{style:{marginBottom:"20px",textAlign:"right"},children:(0,a.jsx)("a",{href:"/",style:{display:"inline-block",padding:"10px 20px",backgroundColor:"#007bff",color:"white",textDecoration:"none",borderRadius:"5px",fontWeight:"bold"},children:"← Back to Add Money"})}),(0,a.jsx)("h2",{style:{marginTop:0},children:"Payment Response Details"}),f&&(0,a.jsx)("div",{style:{padding:"20px",textAlign:"center",backgroundColor:"#f8f9fa",borderRadius:"5px",marginBottom:"20px"},children:(0,a.jsx)("p",{style:{margin:0},children:"⏳ Processing payment response..."})}),u&&!f&&(0,a.jsx)(c.A,{status:u,message:h}),t&&(0,a.jsx)("div",{style:{marginBottom:"1rem",padding:"10px",borderRadius:"5px",backgroundColor:"success"===t?"#d4edda":"#f8d7da",border:"1px solid ".concat("success"===t?"#c3e6cb":"#f5c6cb"),color:"success"===t?"#155724":"#721c24"},children:(0,a.jsx)("strong",{children:d})}),!f&&0===e.length&&(0,a.jsxs)("div",{style:{padding:"40px",textAlign:"center",backgroundColor:"#fff3cd",border:"1px solid #ffc107",borderRadius:"5px",marginBottom:"20px"},children:[(0,a.jsx)("h3",{style:{color:"#856404",marginTop:0},children:"⚠️ No Payment Data Found"}),(0,a.jsx)("p",{style:{color:"#856404"},children:"No payment response data was received. This could happen if:"}),(0,a.jsxs)("ul",{style:{textAlign:"left",display:"inline-block",color:"#856404"},children:[(0,a.jsx)("li",{children:"Payment gateway did not redirect properly with parameters"}),(0,a.jsx)("li",{children:"Payment transaction was not completed"}),(0,a.jsx)("li",{children:"You accessed this page directly without completing a payment"})]}),(0,a.jsx)("p",{style:{color:"#856404",marginTop:"20px"},children:"Please check your browser console (F12) for detailed debugging information."})]}),e.length>0&&(0,a.jsxs)("div",{style:{marginTop:"20px"},children:[(0,a.jsx)("h3",{style:{marginBottom:"10px"},children:"Response Data:"}),(0,a.jsxs)("table",{border:"1",cellPadding:"10",cellSpacing:"0",style:{width:"100%",borderCollapse:"collapse",backgroundColor:"white"},children:[(0,a.jsx)("thead",{style:{backgroundColor:"#f2f2f2"},children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{style:{textAlign:"left",padding:"12px"},children:"Field"}),(0,a.jsx)("th",{style:{textAlign:"left",padding:"12px"},children:"Value"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>{let[s,t]=e;return(0,a.jsxs)("tr",{style:{borderBottom:"1px solid #ddd"},children:[(0,a.jsx)("td",{style:{padding:"10px",fontWeight:"bold"},children:s}),(0,a.jsx)("td",{style:{padding:"10px",wordBreak:"break-word"},children:null==t?(0,a.jsx)("i",{style:{color:"gray"},children:"N/A"}):"object"==typeof t?(0,a.jsx)("pre",{style:{margin:0,fontSize:"12px",overflow:"auto"},children:JSON.stringify(t,null,2)}):String(t)})]},s)})})]})]})]})}}},e=>{e.O(0,[359,441,964,358],()=>e(e.s=4386)),_N_E=e.O()}]);