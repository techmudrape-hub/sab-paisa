{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/techs/Downloads/nextjs_1%20%282%29/nextjs_1/src/lib/crypto/signature.js"],"sourcesContent":["import crypto from 'node:crypto'\r\n\r\nexport function createHmacSha256Signature(payloadObject) {\r\n  if (!process.env.SHARED_SECRET) {\r\n    throw new Error('Missing SHARED_SECRET environment variable')\r\n  }\r\n\r\n  const json = JSON.stringify(payloadObject)\r\n  const hmac = crypto.createHmac('sha256', process.env.SHARED_SECRET)\r\n  hmac.update(json, 'utf8')\r\n  const signatureHex = hmac.digest('hex')\r\n  return { json, signatureHex }\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;AAAA;;AAEO,SAAS,0BAA0B,aAAa;IACrD,IAAI,CAAC,QAAQ,GAAG,CAAC,aAAa,EAAE;QAC9B,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,OAAO,KAAK,SAAS,CAAC;IAC5B,MAAM,OAAO,qHAAA,CAAA,UAAM,CAAC,UAAU,CAAC,UAAU,QAAQ,GAAG,CAAC,aAAa;IAClE,KAAK,MAAM,CAAC,MAAM;IAClB,MAAM,eAAe,KAAK,MAAM,CAAC;IACjC,OAAO;QAAE;QAAM;IAAa;AAC9B","debugId":null}},
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/techs/Downloads/nextjs_1%20%282%29/nextjs_1/src/lib/database.js"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst DB_FILE = path.join(process.cwd(), 'data', 'transactions.json');\r\n\r\n// Ensure data directory exists\r\nconst ensureDataDir = () => {\r\n  const dataDir = path.dirname(DB_FILE);\r\n  if (!fs.existsSync(dataDir)) {\r\n    fs.mkdirSync(dataDir, { recursive: true });\r\n  }\r\n};\r\n\r\n// Read transactions from file\r\nexport const readTransactions = () => {\r\n  try {\r\n    ensureDataDir();\r\n    if (!fs.existsSync(DB_FILE)) {\r\n      return [];\r\n    }\r\n    const data = fs.readFileSync(DB_FILE, 'utf8');\r\n    return JSON.parse(data);\r\n  } catch (error) {\r\n    console.error('Error reading transactions:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n// Write transactions to file\r\nexport const writeTransactions = (transactions) => {\r\n  try {\r\n    ensureDataDir();\r\n    fs.writeFileSync(DB_FILE, JSON.stringify(transactions, null, 2));\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error writing transactions:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Save a single transaction\r\nexport const saveTransaction = (transactionData) => {\r\n  try {\r\n    const transactions = readTransactions();\r\n    \r\n    // Check if transaction already exists (by txnId)\r\n    const existingIndex = transactions.findIndex(t => t.txnId === transactionData.txnId);\r\n    \r\n    if (existingIndex >= 0) {\r\n      // Update existing transaction\r\n      transactions[existingIndex] = {\r\n        ...transactions[existingIndex],\r\n        ...transactionData,\r\n        updatedAt: new Date().toISOString()\r\n      };\r\n    } else {\r\n      // Add new transaction\r\n      transactions.push({\r\n        ...transactionData,\r\n        createdAt: transactionData.createdAt || new Date().toISOString(),\r\n        updatedAt: new Date().toISOString()\r\n      });\r\n    }\r\n    \r\n    const success = writeTransactions(transactions);\r\n    if (success) {\r\n      console.log(`Transaction ${transactionData.txnId} saved with status: ${transactionData.status}`);\r\n    }\r\n    return success;\r\n  } catch (error) {\r\n    console.error('Error saving transaction:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Get transaction by txnId\r\nexport const getTransaction = (txnId) => {\r\n  const transactions = readTransactions();\r\n  return transactions.find(t => t.txnId === txnId);\r\n};\r\n\r\n// Get all transactions\r\nexport const getAllTransactions = () => {\r\n  return readTransactions();\r\n};\r\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;;;AAEA,MAAM,UAAU,iGAAA,CAAA,UAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;AAEjD,+BAA+B;AAC/B,MAAM,gBAAgB;IACpB,MAAM,UAAU,iGAAA,CAAA,UAAI,CAAC,OAAO,CAAC;IAC7B,IAAI,CAAC,6FAAA,CAAA,UAAE,CAAC,UAAU,CAAC,UAAU;QAC3B,6FAAA,CAAA,UAAE,CAAC,SAAS,CAAC,SAAS;YAAE,WAAW;QAAK;IAC1C;AACF;AAGO,MAAM,mBAAmB;IAC9B,IAAI;QACF;QACA,IAAI,CAAC,6FAAA,CAAA,UAAE,CAAC,UAAU,CAAC,UAAU;YAC3B,OAAO,EAAE;QACX;QACA,MAAM,OAAO,6FAAA,CAAA,UAAE,CAAC,YAAY,CAAC,SAAS;QACtC,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,EAAE;IACX;AACF;AAGO,MAAM,oBAAoB,CAAC;IAChC,IAAI;QACF;QACA,6FAAA,CAAA,UAAE,CAAC,aAAa,CAAC,SAAS,KAAK,SAAS,CAAC,cAAc,MAAM;QAC7D,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO;IACT;AACF;AAGO,MAAM,kBAAkB,CAAC;IAC9B,IAAI;QACF,MAAM,eAAe;QAErB,iDAAiD;QACjD,MAAM,gBAAgB,aAAa,SAAS,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK,gBAAgB,KAAK;QAEnF,IAAI,iBAAiB,GAAG;YACtB,8BAA8B;YAC9B,YAAY,CAAC,cAAc,GAAG;gBAC5B,GAAG,YAAY,CAAC,cAAc;gBAC9B,GAAG,eAAe;gBAClB,WAAW,IAAI,OAAO,WAAW;YACnC;QACF,OAAO;YACL,sBAAsB;YACtB,aAAa,IAAI,CAAC;gBAChB,GAAG,eAAe;gBAClB,WAAW,gBAAgB,SAAS,IAAI,IAAI,OAAO,WAAW;gBAC9D,WAAW,IAAI,OAAO,WAAW;YACnC;QACF;QAEA,MAAM,UAAU,kBAAkB;QAClC,IAAI,SAAS;YACX,QAAQ,GAAG,CAAC,CAAC,YAAY,EAAE,gBAAgB,KAAK,CAAC,oBAAoB,EAAE,gBAAgB,MAAM,EAAE;QACjG;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO;IACT;AACF;AAGO,MAAM,iBAAiB,CAAC;IAC7B,MAAM,eAAe;IACrB,OAAO,aAAa,IAAI,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK;AAC5C;AAGO,MAAM,qBAAqB;IAChC,OAAO;AACT","debugId":null}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/techs/Downloads/nextjs_1%20%282%29/nextjs_1/src/app/api/transactions/route.js"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport { createHmacSha256Signature } from '@/lib/crypto/signature'\r\nimport { saveTransaction, getAllTransactions, getTransaction } from '@/lib/database'\r\n\r\nexport async function POST(request) {\r\n  try {\r\n    console.log('API route called - checking environment variables')\r\n    console.log('SITE_B_ENDPOINT:', process.env.SITE_B_ENDPOINT)\r\n    console.log('SHARED_SECRET exists:', !!process.env.SHARED_SECRET)\r\n    \r\n    if (!process.env.SITE_B_ENDPOINT) {\r\n      console.error('Missing SITE_B_ENDPOINT environment variable')\r\n      return NextResponse.json({ error: 'Missing SITE_B_ENDPOINT' }, { status: 500 })\r\n    }\r\n\r\n    const body = await request.json()\r\n    console.log('Received transaction data:', body)\r\n\r\n    const requiredFields = ['referenceId', 'amount', 'type', 'description', 'metadata', 'createdAt']\r\n    for (const field of requiredFields) {\r\n      if (!(field in body)) {\r\n        return NextResponse.json({ error: `Missing field: ${field}` }, { status: 400 })\r\n      }\r\n    }\r\n\r\n    // Save transaction to local database first\r\n    console.log('Saving transaction to local database...')\r\n    const dbSuccess = saveTransaction(body)\r\n    if (!dbSuccess) {\r\n      console.error('Failed to save transaction to local database')\r\n      return NextResponse.json({ error: 'Failed to save transaction locally' }, { status: 500 })\r\n    }\r\n    console.log('Transaction saved to local database successfully')\r\n\r\n    const { json, signatureHex } = createHmacSha256Signature(body)\r\n    console.log('Generated signature:', signatureHex)\r\n    console.log('Sending to Site B:', process.env.SITE_B_ENDPOINT)\r\n\r\n    const upstreamHeaders = {\r\n      'Content-Type': 'application/json',\r\n      'X-Signature': signatureHex,\r\n    }\r\n\r\n    // Prefer Authorization header from incoming request; else use env token if present\r\n    const incomingAuth = request.headers.get('authorization')\r\n    const envAuthToken = process.env.SITE_B_BEARER_TOKEN\r\n    if (incomingAuth) {\r\n      upstreamHeaders['Authorization'] = incomingAuth\r\n    } else if (envAuthToken) {\r\n      upstreamHeaders['Authorization'] = `Bearer ${envAuthToken}`\r\n    }\r\n\r\n    if (!upstreamHeaders['Authorization']) {\r\n      console.warn('No Authorization header provided for Site B request')\r\n    }\r\n\r\n    // For testing: Skip Site B call and return success\r\n    if (process.env.NODE_ENV === 'development' && !process.env.SITE_B_ENDPOINT) {\r\n      console.log('Development mode: Skipping Site B call')\r\n      return NextResponse.json({ \r\n        success: true, \r\n        message: 'Transaction saved (development mode)',\r\n        transactionId: body.referenceId \r\n      }, { status: 200 })\r\n    }\r\n\r\n    const res = await fetch(process.env.SITE_B_ENDPOINT, {\r\n      method: 'POST',\r\n      headers: upstreamHeaders,\r\n      body: json,\r\n      cache: 'no-store',\r\n    })\r\n\r\n    const text = await res.text()\r\n    let parsed\r\n    try { parsed = text ? JSON.parse(text) : null } catch (e) { parsed = { raw: text } }\r\n\r\n    console.log('Site B response status:', res.status)\r\n    console.log('Site B response:', parsed)\r\n\r\n    if (!res.ok) {\r\n      console.error('Site B returned error:', { status: res.status, data: parsed })\r\n      return NextResponse.json({ error: 'Upstream error', status: res.status, data: parsed }, { status: 502 })\r\n    }\r\n\r\n    return NextResponse.json(parsed ?? null, { status: 200 })\r\n  } catch (error) {\r\n    console.error('API route error:', error)\r\n    return NextResponse.json({ error: 'Unexpected error', message: error?.message ?? String(error) }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function GET(request) {\r\n  try {\r\n    const { searchParams } = new URL(request.url)\r\n    const txnId = searchParams.get('txnId')\r\n    \r\n    // If txnId is provided, return specific transaction\r\n    if (txnId) {\r\n      console.log(`GET /api/transactions?txnId=${txnId} - fetching transaction`)\r\n      const transaction = getTransaction(txnId)\r\n      if (!transaction) {\r\n        return NextResponse.json({ error: 'Transaction not found' }, { status: 404 })\r\n      }\r\n      console.log(`Found transaction: ${txnId}`)\r\n      return NextResponse.json(transaction, { status: 200 })\r\n    }\r\n    \r\n    // Otherwise return all transactions\r\n    console.log('GET /api/transactions - fetching all transactions')\r\n    const transactions = getAllTransactions()\r\n    console.log(`Found ${transactions.length} transactions`)\r\n    return NextResponse.json(transactions, { status: 200 })\r\n  } catch (error) {\r\n    console.error('Error fetching transactions:', error)\r\n    return NextResponse.json({ error: 'Failed to fetch transactions', message: error?.message ?? String(error) }, { status: 500 })\r\n  }\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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","debugId":null}}]
}